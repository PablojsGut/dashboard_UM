<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Iniciativas - VcM</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    rel="stylesheet"
    />
    <link rel="stylesheet" href="style/main.css">
</head>
<body>
    <header class="header-um">
        <div class="container">
            <div class="row align-items-center">

                <!-- Logo -->
                <div class="col-auto">
                    <a 
                        href="https://pablojsgut.cl/dashboard_VcM/" 
                        target="_blank" 
                        rel="noopener noreferrer"
                        aria-label="Ir al Dashboard Universidad Mayor"
                    >
                        <img 
                            src="favicon.ico" 
                            alt="Universidad Mayor" 
                            class="dashboard-icon"
                        >
                    </a>
                </div>

                <!-- T√≠tulo y subt√≠tulo -->
                <div class="col">
                    <h1 class="dashboard-title mb-1">
                        Dashboard Vinculaci√≥n con el Medio
                    </h1>
                    <p class="dashboard-subtitle mb-1">
                        Gesti√≥n y seguimiento de iniciativas v√≠a Excel
                    </p>

                    <!-- Link a Unificador -->
                    <a
                        href="unificador.html"
                        class="icon-link icon-link-hover text-decoration-none"
                    >
                        Ir al Unificador de Iniciativas - VcM
                        <i class="bi bi-arrow-right"></i>
                    </a>
                </div>

            </div>
        </div>
    </header>

    <!-- EXCEL -->
    <div class="container mb-4">
        <div class="excel-section">

            <div class="excel-title mb-3">
                üìÑ Carga de Archivos Excel
            </div>

            <!-- EXCEL FASE 1 -->
            <div class="mb-3">
                <label class="form-label">
                    Excel Iniciativas <span class="text-muted">(Fase 1)</span>
                </label>
                <input
                    type="file"
                    id="excelInputAmbasFase1"
                    class="form-control form-control-sm excel-input"
                    accept=".xlsx,.xls"
                >
            </div>

            <!-- EXCEL FASE 2 -->
            <div class="mb-3">
                <label class="form-label">
                    Excel S√≠ntesis <span class="text-muted">(Fase 2)</span>
                </label>
                <input
                    type="file"
                    id="excelInputAmbasFase2"
                    class="form-control form-control-sm excel-input"
                    accept=".xlsx,.xls"
                >
            </div>

            <!-- BOT√ìN -->
            <div class="d-flex align-items-center gap-3 mt-4">
                <button
                    class="btn btn-success btn-sm d-inline-flex align-items-center gap-2"
                    onclick="exportExcelUnido()"
                >
                    <i class="bi bi-download"></i>
                    Descargar Excel Unificado
                </button>

                <span class="text-muted small">
                    Debes cargar ambos archivos
                </span>
            </div>

        </div>
    </div>

    <!-- ALERTA -->
    <div class="container mt-3">
        <div id="alertsContainer"></div>
    </div>

    <!-- FILTROS -->
    <div class="container filters-section mb-4">
        <div class="filters-title mb-3">
            üîç Filtros Globales
        </div>

        <div class="row g-3">
            <!-- Sede -->
            <div class="col-12 col-md-6 col-lg-3">
                <label for="filterSede" class="form-label">Sede</label>
                <select id="filterSede" class="form-select">
                    <option value="">Todas las sedes</option>
                    <option value="Santiago">Santiago</option>
                    <option value="Temuco">Temuco</option>
                </select>
            </div>

            <!-- Dependencia -->
            <div class="col-12 col-md-6 col-lg-3">
                <label for="filterDependencia" class="form-label">Dependencia</label>
                <select id="filterDependencia" class="form-select">
                    <option value="">Todas las dependencias</option>
                </select>
            </div>

            <!-- Unidad Acad√©mica -->
            <div class="col-12 col-md-6 col-lg-3">
                <label for="filterUnidad" class="form-label">
                    Unidad Acad√©mica
                    <span class="text-muted small">(Pregrado / Postgrado)</span>
                </label>
                <select id="filterUnidad" class="form-select">
                    <option value="">Todas las unidades</option>
                </select>
            </div>

            <!-- Mecanismo VcM -->
            <div class="col-12 col-md-6 col-lg-3">
                <label for="filterMecanismo" class="form-label">
                    Mecanismo VcM
                </label>
                <select id="filterMecanismo" class="form-select">
                    <option value="">Todos los mecanismos</option>
                </select>
            </div>
        </div>

        <!-- BOTONES -->
        <div class="d-flex flex-wrap gap-2 mt-4">
            <button class="btn btn-primary" onclick="applyFilters()" >
                ‚úì Aplicar Filtros
            </button>
            <button class="btn btn-outline-secondary" onclick="clearFilters()">
                ‚Üª Limpiar Filtros
            </button>
        </div>
    </div>

    <!-- DATOS -->
    <div class="container">
        <div class="kpis-grid" id="kpisContainer"></div>
    </div>

    <!-- TABS -->
    <div class="container mt-4 d-none" id="tabsSection">

        <!-- NAV TABS -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button
                    class="nav-link active"
                    id="resumen-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tabResumen"
                    type="button"
                    role="tab">
                    Resumen
                </button>
            </li>

            <li class="nav-item" role="presentation">
                <button
                    class="nav-link"
                    id="buscador-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tabBuscador"
                    type="button"
                    role="tab">
                    Buscador
                </button>
            </li>

            <li class="nav-item" role="presentation">
                <button
                    class="nav-link"
                    id="analisis-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#tabAnalisis"
                    type="button"
                    role="tab">
                    An√°lisis
                </button>
            </li>
        </ul>

        <!-- TAB CONTENT -->
        <div class="tab-content pt-4">

            <!-- =========================
                TAB RESUMEN (GR√ÅFICOS)
            ========================== -->
            <div
                class="tab-pane fade show active"
                id="tabResumen"
                role="tabpanel">

                <!-- GR√ÅFICOS -->
                <div class="container d-none" id="chartsSection">

                    <div class="row g-4">

                        <!-- Avance Fase -->
                        <div class="col-12">
                            <div class="chart-card chart-card-lg">
                                <h6 class="chart-title text-center">
                                    Avance de Fase 1 ‚Üí Fase 2
                                </h6>
                                <canvas id="chartAvanceFase"></canvas>
                            </div>
                        </div>

                        <!-- Estados -->
                        <div class="col-12 col-md-6">
                            <div class="chart-card chart-card-sm">
                                <h6 class="chart-title text-center">
                                    Estado Fase 1
                                </h6>
                                <canvas id="chartEstadoIniciativas"></canvas>
                            </div>
                        </div>

                        <div class="col-12 col-md-6">
                            <div class="chart-card chart-card-sm">
                                <h6 class="chart-title text-center">
                                    Estado Fase 2
                                </h6>
                                <canvas id="chartEstadoSintesis"></canvas>
                            </div>
                        </div>

                        <!-- TOTAL REGISTROS POR SEDE -->
                        <div class="col-12 d-none" id="chartSedeTotalWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n Total de Registros por Sede
                                </h6>
                                <canvas id="chartSedeTotal"></canvas>
                            </div>
                        </div>

                        <!-- SEDES INICIATIVAS -->
                        <div class="col-12 col-md-6" id="chartSedeWrapper">
                            <div class="chart-card chart-card-sm">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Sede (Fase 1)
                                </h6>
                                <canvas id="chartSedeIniciativas"></canvas>
                            </div>
                        </div>

                        <!-- SEDES S√çNTESIS -->
                        <div class="col-12 col-md-6" id="chartSedeSintesisWrapper">
                            <div class="chart-card chart-card-sm">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Sede (Fase 2)
                                </h6>
                                <canvas id="chartSedeSintesis"></canvas>
                            </div>
                        </div>

                        <!-- DISTRIBUCI√ìN POR DEPENDENCIA (TOTAL) -->
                        <div class="col-12 d-none" id="chartDependenciasTotalWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n total por Dependencia
                                </h6>
                                <canvas id="chartDependenciasTotal"></canvas>
                            </div>
                        </div>

                        <!-- DEPENDENCIAS -->
                        <div class="col-12 col-md-6 d-none" id="chartDependenciasIniciativasWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Dependencia (Fase 1)
                                </h6>
                                <canvas id="chartDependenciasIniciativas"></canvas>
                            </div>
                        </div>

                        <div class="col-12 col-md-6 d-none" id="chartDependenciasSintesisWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Dependencia (Fase 2)
                                </h6>
                                <canvas id="chartDependenciasSintesis"></canvas>
                            </div>
                        </div>

                        <!-- ============================= -->
                        <!-- DISTRIBUCI√ìN POR UNIDAD ACAD√âMICA -->
                        <!-- ============================= -->

                        <!-- TOTAL -->
                        <div class="col-12 d-none" id="chartUnidadesTotalWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n total por Unidad Acad√©mica
                                </h6>
                                <canvas id="chartUnidadesTotal"></canvas>
                            </div>
                        </div>

                        <!-- FASE 1 -->
                        <div class="col-12 col-md-6 d-none" id="chartUnidadesIniciativasWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Unidad Acad√©mica (Fase 1)
                                </h6>
                                <canvas id="chartUnidadesIniciativas"></canvas>
                            </div>
                        </div>

                        <!-- FASE 2 -->
                        <div class="col-12 col-md-6 d-none" id="chartUnidadesSintesisWrapper">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Distribuci√≥n por Unidad Acad√©mica (Fase 2)
                                </h6>
                                <canvas id="chartUnidadesSintesis"></canvas>
                            </div>
                        </div>


                        <!-- Iniciativas por mes -->
                        <div class="col-12">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Registros Enviados por Mes (Fase 1)
                                </h6>
                                <div id="chartsIniciativasPorMes"></div>
                            </div>
                        </div>

                        <!-- S√≠ntesis por mes -->
                        <div class="col-12">
                            <div class="chart-card chart-card-md">
                                <h6 class="chart-title text-center">
                                    Registros Enviados por Mes (Fase 2)
                                </h6>
                                <div id="chartsSintesisPorMes"></div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- =========================
                TAB BUSCADOR
            ========================== -->
            <div
                class="tab-pane fade"
                id="tabBuscador"
                role="tabpanel">

                <div class="container mt-3">

                    <div class="input-group input-group-sm mb-3">
                        <span class="input-group-text um-search-icon">
                            <i class="bi bi-search"></i>
                        </span>
                        <input
                            type="text"
                            id="buscadorInput"
                            class="form-control um-input"
                            placeholder="Buscar por ID, Email o Nombre de la Iniciativa VcM‚Ä¶"
                        >
                    </div>

                    <div class="table-responsive">
                        <table class="table table-dark table-hover align-middle">
                            <thead>
                                <tr>
                                    <th>N¬∞</th>
                                    <th>ID</th>
                                    <th>Email</th>
                                    <th>Nombre de la Iniciativa VcM</th>
                                    <th>Dependencia Responsable</th>
                                    <th>Unidad Acad√©mica</th>
                                    <th>Estado F1</th>
                                    <th>Estado F2</th>
                                    <th>Nota F1</th>
                                    <th>Nota F2</th>
                                </tr>
                            </thead>
                            <tbody id="buscadorTableBody">
                                <!-- filas din√°micas -->
                            </tbody>
                        </table>
                    </div>

                    <!-- PAGINACI√ìN -->
                    <nav class="d-flex justify-content-center">
                        <ul class="pagination pagination-sm" id="buscadorPagination">
                            <!-- botones din√°micos -->
                        </ul>
                    </nav>

                </div>
            </div>

            <!-- =========================
                TAB AN√ÅLISIS
            ========================== -->
            <div
                class="tab-pane fade"
                id="tabAnalisis"
                role="tabpanel">

                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="chart-card chart-card-sm">
                            <h6 class="chart-title text-center">
                                Mecanismo VcM ‚Äì Iniciativas Enviadas
                            </h6>
                            <canvas id="chartMecanismoIniciativas"></canvas>
                        </div>
                    </div>

                    <div class="col-12 col-md-6">
                        <div class="chart-card chart-card-sm">
                            <h6 class="chart-title text-center">
                                Mecanismo VcM ‚Äì S√≠ntesis Enviadas
                            </h6>
                            <canvas id="chartMecanismoSintesis"></canvas>
                        </div>
                    </div>
                </div>

                <div style="height: 400px;">
                    <canvas id="chartVCMIniciativas"></canvas>
                </div>
                <div style="height: 400px;">
                    <canvas id="chartVCMSintesis"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- MODAL DETALLE REGISTRO -->
    <div class="modal fade" id="modalDetalle" tabindex="-1">
        <div class="modal-dialog modal-dialog-scrollable modal-md">
            <div class="modal-content">

            <div class="modal-header flex-column align-items-start">

                <h5 class="modal-title mb-1">
                    <span id="modalDetalleNombreHeader"></span>
                </h5>

                <small class="text-muted">
                    ID: <span id="modalDetalleIDHeader"></span>
                </small>

                <button
                    type="button"
                    class="btn-close position-absolute top-0 end-0 m-3"
                    data-bs-dismiss="modal">
                </button>

            </div>


            <div class="modal-body">
                <div class="d-flex align-items-center mt-4 mb-2">
                    <h6 class="mb-0 fw-bold text-uppercase">
                        Postulante
                    </h6>
                </div>
                <hr class="mt-1 mb-2">
                <p><strong>Nombre:</strong> <span id="modalDetalleNombre"></span></p>
                <p><strong>Email:</strong> <span id="modalDetalleEmail"></span></p>

                <hr>
                <div class="d-flex align-items-center mt-4 mb-2">
                    <h6 class="mb-0 fw-bold text-uppercase">
                        Iniciativa
                    </h6>
                </div>
                <hr class="mt-1 mb-2">
                <p><strong>Sede:</strong> <span id="modalDetalleSede"></span></p>

                <p><strong>Modalidad:</strong> <span id="modalDetalleModalidad"></span></p>

                <p><strong>Fecha Inicio:</strong> <span id="modalDetalleFechaInicio"></span></p>
                <p><strong>Fecha T√©rmino:</strong> <span id="modalDetalleFechaTermino"></span></p>

                <p><strong>Descripci√≥n:</strong></p>
                <p id="modalDetalleDescripcion" class="small"></p>

                <p><strong>Monto Financiamiento Requerido:</strong>
                    <span id="modalDetalleMonto"></span>
                </p>

                <p><strong>Antig√ºedad Iniciativa:</strong>
                    <span id="modalDetalleAntiguedad"></span>
                </p>

                <p><strong>C√≥digo VcM presupuesto anterior:</strong>
                    <span id="modalDetalleCodigoVCM"></span>
                </p>

                <p><strong>Acceso:</strong>
                    <span id="modalDetalleAcceso"></span>
                </p>

                <p><strong>Tipo de Acceso:</strong>
                    <span id="modalDetalleTipoAcceso"></span>
                </p>

                <hr>

                <div class="d-flex align-items-center mt-4 mb-2">
                    <h6 class="mb-0 fw-bold text-uppercase">
                        Mecanismos de Vinculaci√≥n con el Medio
                    </h6>
                </div>
                <hr class="mt-1 mb-2">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Mecanismo VcM</th>
                                <th class="text-center">Cumple</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Vinculaci√≥n Acad√©mica - VA</td>
                                <td class="text-center" id="mecanismoVA"></td>
                            </tr>
                            <tr>
                                <td>Articulaci√≥n e Intercambio de Conocimiento - AIC</td>
                                <td class="text-center" id="mecanismoAIC"></td>
                            </tr>
                            <tr>
                                <td>Vinculaci√≥n Art√≠stico-Cultural - VAC</td>
                                <td class="text-center" id="mecanismoVAC"></td>
                            </tr>
                            <tr>
                                <td>Investigaci√≥n, Proyectos de Emprendimiento y Estudios - IPEE</td>
                                <td class="text-center" id="mecanismoIPEE"></td>
                            </tr>
                            <tr>
                                <td>Internacionalizaci√≥n - INT</td>
                                <td class="text-center" id="mecanismoINT"></td>
                            </tr>
                            <tr>
                                <td>Graduados/Titulados, Empleabilidad y Redes - GTER</td>
                                <td class="text-center" id="mecanismoGTER"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>


            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">
                Cerrar
                </button>
            </div>

            </div>
        </div>
    </div>

    <footer class="footer-um mt-5">
        <div class="container">
            <div class="row align-items-center py-4">
                
                <!-- Izquierda: texto -->
                <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
                    <span class="footer-text">
                        ¬© 2025 Universidad Mayor ¬∑ Dashboard VcM
                    </span>
                </div>

                <!-- Derecha: links -->
                <div class="col-md-6">
                    <ul class="nav justify-content-center justify-content-md-end">
                        <li class="nav-item">
                            <a 
                                class="nav-link footer-link"
                                href="https://github.com/PablojsGut/dashboard_UM"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                <i class="bi bi-github me-1"></i> GitHub
                            </a>
                        </li>
                        <li class="nav-item">
                            <a 
                                class="nav-link footer-link"
                                href="https://youtu.be/5z1O5AZl1_8"
                                target="_blank"
                                rel="noopener noreferrer"
                            >
                                <i class="bi bi-youtube me-1"></i> YouTube
                            </a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="js/columnsConfig.js"></script>
    <script src="js/excelValidator.js"></script>
    <script src="js/alert.js"></script>
    <script src="js/buscadorLogic.js"></script>
    <script src="js/excelLogic.js"></script>
    <script src="js/excelExport.js"></script>
    <script src="js/kpis.js"></script>
    <script src="js/dependenciasView.js"></script>
    <script src="js/filtersLogic.js"></script>
    <script src="js/chartsLogic.js"></script>
    <script src="js/chartAnalisis.js"></script>
</body>
</html>